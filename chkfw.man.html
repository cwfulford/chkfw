<h2 id="heading1">NAME</h2>
<b>chkfw</b>
- check (and correct) running iptables firewall configurations on a remote host.</p>
<h2 id="heading2">SYNOPSIS</h2>
<b>chkfw</b> [[<b>-C</b>] [<b>-cc </b><i><email_address></i>] [<b>-d</b>]</p>
[<b>-l</b>]</p>
[<b>-m</b><i> <#max_wait></i>]</p>
[<b>-n</b>] [<b>-p </b><i><#,#...></i>] [<b>-T</b>] [<b>-u</b>|<b>-U</b>] [<b>-v</b>]] |</p>
<i><hostname></i>|<b>-V</b></p>
<h2 id="heading3">AVAILABILITY</h2>
<b>chkfw</b>
is a Bourne shell script which should work equally well on all versions of UNIX,
Linux and Mac OS X.
<h2 id="heading4">DESCRIPTION</h2>
<b>chkfw</b>
checks running firewalls against a known template on the administration
server. If the running firewall's configuration has deviated from the known
configuration
<b>chkfw</b>
will attempt to restore the firewall to the approved configuration provided that
the local firewall configuration and boot files are identical to those on the
administration box and that the plesk configured firewall (if any) has not been activated.
Urgent alerts are sent by email and optionally by SMS test message (see <b>-T</b> option</p>
below).
<p>
Additionally ports which are expected to be open may be checked if enumerated
on the command line.
<h2 id="heading5">OPTIONS</h2>
<p class="indent"> 5
<b>-C</b></p>
Check and report on status of firewall and enumerated ports only. Do not change
running configuration.
<p class="indent">
<b>-cc </b></p>
.I <email_address>
.br
Send copies of warnings and alerts to 
.I email_address
<p class="indent">
<b>-d</b></p>
Start in debug mode.
.IR chkfw .
A message will also be emailed to the address set as 
.I email_rcpt
with copies to
.I email_address
if set with the 
.I -cc</p>
option.
<p class="indent">
<b>--force-restore</b></p>
This option should only be used with extreme caution. The firewall will be restarted
with the configuration on the remote host as found in 
.I /etc/sysconfig/iptables
and 
.IR /etc/sysconfig/iptables-config ,</p>
even if these differ from the canonical files stored on the administration server. 
<p class="indent"> 5
<b>-l</b></p>
Use the <i>syslog</i> facility to log the check and any alerts generated.
<p class="indent">
<b>-m #</b><i><maxi_wait></i></p>
Set the maximum time (in minutes) to wait for the 
ports to become available.
<p class="indent">
<p class="indent"> 5
<b>-p #</b>[,<b>#</b>[,<b>#</b>]....]</p>
Enumerated ports to be scanned with 
.BR nmap .
<p class="indent">
<b>-T</b></p>
When raising alerts additionally send text messages to the recipient specified with the variable 
.IR $txt .
The mechanism employed is an email to SMS gateway so 
.I $txt
is a suitable email address.
<p class="indent">
<b>-u</b></p>
Update the firewall tables and firewall configuration file to synchronise
the administration server with the target host only. 
<b>chkfw</b>
will compare the output of 
<b>"iptables -nL"</b></p>
with a template kept on the administration server and if they differ will
archive the existing template and update the template with a copy of the output
from the target host. The firewall configuration file will similarly be updated.
This is to facilitate making changes on the target host and then synchronising 
the records on the administration server.
<b>NB</b>
The source file for reconfiguring the target host iptables is not at present
changed by using 
<b>-u</b></p>
option.
<p class="indent">
<b>-U</b></p>
With the
<b>-U</b></p>
option the source firewall boot file will be updated from the remote firewall boot
file (<i>/etc/sysconfig/iptables</i> by default) in addition to the template and configuration
file as with the 
<b>-u</b></p>
option above. It is an error to combine 
<b>-u</b></p>
and 
<b>-U</b></p>
on the command line. 
<p class="indent">
<b>-v</b></p>
Set verbose mode. Ordinarily 
<b>chkfw</b>
operates silently unless problems are detected. In 
.I verbose
mode 
<b>chkfw</b>
reports on each significant action.
<p class="indent"> 5
<b>-V</b></p>
Print version details and exit.
<h2 id="heading6">EXAMPLES</h2>
.IP
.ft CW
chkfw -m 30 -p 21,22 -v hostname</p>
.ft R
<p>
Check the running 
<b>iptables </b>
firewall on 
.IR hostname .
Use 
<b>nmap</b>
to ensure that the ports 21 and 22 are open. Run in verbose mode.
<h2 id="heading7">FILES</h2>
.IR <hostname>:/etc/sysconfig/iptables ,
.IR <hostname>:/etc/sysconfig/iptables-config</p>
.IR /usr/local/etc/<hostname>.d/fw .

<h2 id="heading8">BUGS</h2>
The script is quite crude having been developed to address problems experienced
by City Linux clients running on CentOS servers at 1and1. It does depend on
very specific file and remote access permissions. Particularly it expects that
where root permission is required 
<b>sudo</b>
will be used. With judicious use of the 
.I debug
and
.I verbose 
modes, permission and configuration problems should be relatively easy to 
resolve.
<p>
The check on ftp transfer rates has been recently removed.
<h2 id="heading9">SEE ALSO</h2>
.IR chkdf ,
.IR chkftpd ,
.IR chkmail ,
.IR chkup ,
.IR clean ,
.IR secscan .
.SH AUTHOR
Clifford W Fulford, City Linux. Contact fulford@fulford.net or +44 (0)709 229 5385.
.SH HISTORY
$Id: chkfw.man,v 1.55 2016/02/17 16:46:01 fulford Exp $
